---
import HomeNavItem from '@components/HomeNavItem.astro';
import Circle from '@images/circle.svg';

const navLinks = [
	{
		label: 'Notes',
		href: '/notes/',
	},
	{
		label: 'Articles',
		href: '/articles/',
	},
	{
		label: 'Links',
		href: '/links/',
	},
];

const { pathname } = Astro.url;

// Root pages get aria-current; paginated and entry pages get data-state="active"
function getLinkState(href: string, pathname: string) {
	const normalize = (path: string) => (path.endsWith('/') ? path : path + '/');

	href = normalize(href);
	pathname = normalize(pathname);

	const isRoot = href === '/';
	const isCurrent = href === pathname;

	let isActive = false;

	if (isRoot) {
		// e.g. /2/, /3/
		isActive = /^\/\d+\/$/.test(pathname);
	} else {
		// e.g. /notes/2/, /notes/post-slug/
		isActive = pathname.startsWith(href) && pathname !== href;
	}

	return { isCurrent, isActive };
}
---

<nav class="site-nav pi-space-m">
	<ul class="cluster" role="list">
		{
			(() => {
				const { isCurrent, isActive } = getLinkState('/', pathname);
				return (
					<HomeNavItem
						as="li"
						label="Home"
						aria-current={isCurrent ? 'page' : null}
						data-state={isActive ? 'active' : null}
					>
						<Circle />
					</HomeNavItem>
				);
			})()
		}
		{
			navLinks.map((link) => {
				const { isCurrent, isActive } = getLinkState(link.href, pathname);
				return (
					<li class="nav-item heading-3">
						<a
							class="text-box-trim"
							href={link.href}
							aria-current={isCurrent ? 'page' : null}
							data-state={isActive ? 'active' : null}
						>
							{link.label}
							<Circle />
						</a>
					</li>
				);
			})
		}
	</ul>
</nav>
