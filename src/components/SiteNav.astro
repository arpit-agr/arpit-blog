---
const navLinks = [
	{
		label: "Home",
		href: "/",
	},
	{
		label: "Notes",
		href: "/notes/",
	},
	{
		label: "Articles",
		href: "/articles/",
	},
	{
		label: "Links",
		href: "/links/",
	},
];

const { pathname } = Astro.url;

// Root pages get aria-current; paginated and entry pages get data-state="active"
function getLinkState(href: string, pathname: string) {
  const normalize = (path: string) =>
    path.endsWith("/") ? path : path + "/";

  href = normalize(href);
  pathname = normalize(pathname);

  const isRoot = href === "/";
  const isCurrent = href === pathname;

  let isActive = false;

  if (isRoot) {
    // e.g. /2/, /3/
    isActive = /^\/\d+\/$/.test(pathname);
  } else {
    // e.g. /notes/2/, /notes/post-slug/
    isActive = pathname.startsWith(href) && pathname !== href;
  }

  return { isCurrent, isActive };
}
---

<nav class="site-nav sticky inset-bs-0">
	<ul class="cluster pb-space-m" role="list">
		{
			navLinks.map((link) => {
				const { isCurrent, isActive } = getLinkState(link.href, pathname);
				return (
					<li>
						<a
							class="heading-3 text-box-trim"
							href={link.href}
							aria-current={isCurrent ? "page" : null}
							data-state={isActive ? "active" : null}
						>
							{link.href === "/" ? (
								<span class="profile">
									<img src="/images/arpit-96w.png" alt="" />
								</span><span>{link.label}</span>
							) : <Fragment>{link.label}</Fragment>}
						</a>
					</li>
				);
			})
		}
	</ul>
</nav>
