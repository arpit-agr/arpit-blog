---
import PubDate from "@components/PubDate.astro";
import LinkVia from "@components/LinkVia.astro";
import H2 from "@components/H2.astro";
import H3 from "@components/H3.astro";
import H4 from "@components/H4.astro";
import H5 from "@components/H5.astro";
import H6 from "@components/H6.astro";

const { entries } = Astro.props;

const basePathMap = {
	notes: "/notes",
	articles: "/articles",
	links: "/links",
};

// Custom heading components for offset
const headingComponents = {
	h2: H2,
	h3: H3,
	h4: H4,
	h5: H5,
	h6: H6,
};
---

<ul role="list">
	{
		//@ts-ignore
		entries.map((entry) => {
			//@ts-ignore
			const basePath = basePathMap[entry.collection];
			return (
				<li class="entry">
					<div class="center p-space-m">
						<article class="stack align-self-stretch">
							<footer class="cluster gap-2xs text-step--1">
								<PubDate date={entry.data.pubDate} />
								{!!entry.data.via && (
									<LinkVia
										url={entry.data.via.url}
										label={entry.data.via.label}
									/>
								)}
							</footer>
							<div class="entry-content flow">
								{entry.collection === "articles" && (
									<h2>
										<a href={`${basePath}/${entry.id}/`}>{entry.data.title}</a>
									</h2>
								)}
								{entry.collection === "links" && (
									<h2 class="link-entry-title heading-3">
										<a href={entry.data.link}>{entry.data.title}</a>
									</h2>
								)}
								<entry.Content components={headingComponents} />
							</div>
							<footer class="cluster text-step--1 text-box-trim">
								<!-- <a
									class="text-box-trim"
									href={`${basePath}/${entry.id}/#comments`}
								>
									Reply
								</a> -->
								<a
									class="text-box-trim"
									href={`${basePath}/${entry.id}/`}
									rel="bookmark"
								>
									More about this
								</a>
							</footer>
						</article>
					</div>
				</li>
			);
		})
	}
</ul>

<style is:global>
	@layer blocks {
		.entry + .entry {
			position: relative;

			&::before {
				--separator-angle: 90deg;
				content: "";
				position: absolute;
				background: var(--separator);
				z-index: -1;
				inset-inline: 0;
				inset-block-start: 0;
				inline-size: 100%;
				block-size: var(--border-thickness-s);
			}
		}

		.entry {
			article {
				--stack-horizontal-alignment: stretch;
			}

			[rel="bookmark"] {
				margin-inline-start: auto;
			}
		}
	}
</style>
