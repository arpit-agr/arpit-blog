---
import PubDate from "@components/PubDate.astro";
import LinkVia from "@components/LinkVia.astro";
import ExternalLinkIcon from "src/images/external-link.svg";
import H2 from "@components/H2.astro";
import H3 from "@components/H3.astro";
import H4 from "@components/H4.astro";
import H5 from "@components/H5.astro";
import H6 from "@components/H6.astro";

const { entries } = Astro.props;

// Custom heading components for offset
const headingComponents = {
	h2: H2,
	h3: H3,
	h4: H4,
	h5: H5,
	h6: H6,
};
---

<ul role="list">
	{
		// @ts-expect-error -- `entry` is a union of multiple CollectionEntry types.
		// Each variant has different fields (`via`, `Content`, `absoluteURL`, etc.),
		// so TS requires exhaustive narrowing. At runtime, all accessed fields exist
		// for the specific entry we're working with, making this safe.
		entries.map((entry) => {
			return (
				<li class="entry">
					<div class="center p-space-m">
						<article class="stack align-self-stretch">
							<footer class="text-step--1">
								<PubDate date={entry.data.pubDate} />
							</footer>
							<div class="entry-content flow">
								{entry.collection === "articles" && (
									<h2>
										<a href={entry.absoluteURL}>{entry.data.title}</a>
									</h2>
								)}
								{entry.collection === "links" && (
									<h2 class="link-entry-title heading-3">
										<a href={entry.data.link}>{entry.data.title}</a>
										<ExternalLinkIcon aria-hidden="true" />
									</h2>
								)}
								<entry.Content components={headingComponents} />
								{!!entry.data.via && (
									<LinkVia
										url={entry.data.via.url}
										label={entry.data.via.label}
									/>
								)}
							</div>
							<footer class="cluster text-step--1 text-box-trim">
								<a
									class="text-box-trim"
									href={entry.absoluteURL}
									rel="bookmark"
								>
									More about this
								</a>
							</footer>
						</article>
					</div>
				</li>
			);
		})
	}
</ul>

<style is:global>
	@layer blocks {
		.entry + .entry {
			border-block-start: var(--border-thickness-separator) solid
				var(--color-border);
		}

		.entry {
			article {
				--stack-horizontal-alignment: stretch;
			}

			[rel="bookmark"] {
				margin-inline-start: auto;
			}
		}
	}
</style>
